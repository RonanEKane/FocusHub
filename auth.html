<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - FocusHub</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-box">
            <img src="FocusHub_vertnorm.png" alt="FocusHub" class="auth-logo" style="height: 60px; width: auto; margin: 0 auto 2rem; display: block;">
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>Welcome Back</h2>
                <p class="auth-subtitle">Sign in to continue your productivity journey</p>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    
                    <div id="loginError" class="auth-error hidden"></div>
                    
                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                </form>
                
                <p class="auth-switch">
                    Don't have an account? 
                    <a href="#" onclick="showSignup(); return false;">Sign up</a>
                </p>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="auth-form hidden">
                <h2>Get Started</h2>
                <p class="auth-subtitle">Create your account and choose your mode</p>
                
                <form onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" required minlength="6">
                        <small>At least 6 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPasswordConfirm">Confirm Password</label>
                        <input type="password" id="signupPasswordConfirm" required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label>Choose Your Mode</label>
                        <div class="mode-selector">
                            <label class="mode-option">
                                <input type="radio" name="mode" value="professional" checked>
                                <div class="mode-card">
                                    <h3>ðŸ’¼ Professional</h3>
                                    <p>For work and career productivity</p>
                                </div>
                            </label>
                            
                            <label class="mode-option">
                                <input type="radio" name="mode" value="student">
                                <div class="mode-card">
                                    <h3>ðŸŽ“ Student (High School)</h3>
                                    <p>For academic work and assignments</p>
                                </div>
                            </label>
                        </div>
                        <small>You can change this later in settings</small>
                    </div>
                    
                    <div id="signupError" class="auth-error hidden"></div>
                    
                    <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                </form>
                
                <p class="auth-switch">
                    Already have an account? 
                    <a href="#" onclick="showLogin(); return false;">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Simple auth state management using localStorage
        
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }
        
        function showSignup() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            
            // Get users from localStorage
            const users = JSON.parse(localStorage.getItem('focushub_users') || '[]');
            
            // Find user
            const user = users.find(u => u.email === email);
            
            if (!user) {
                errorEl.textContent = 'No account found with this email';
                errorEl.classList.remove('hidden');
                return;
            }
            
            // Simple password check (in production, this would be properly hashed)
            if (user.password !== btoa(password)) {
                errorEl.textContent = 'Incorrect password';
                errorEl.classList.remove('hidden');
                return;
            }
            
            // Set current user
            localStorage.setItem('focushub_current_user', JSON.stringify({
                id: user.id,
                email: user.email,
                mode: user.mode,
                created: user.created
            }));
            
            // Set mode for config system
            localStorage.setItem('focushub_mode', user.mode);
            if (user.mode === 'student') {
                localStorage.setItem('focushub_student_submode', user.subMode || 'highschool');
            }
            
            // Redirect to app
            window.location.href = 'app.html';
        }
        
        function handleSignup(event) {
            event.preventDefault();
            
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const errorEl = document.getElementById('signupError');
            
            // Validate passwords match
            if (password !== passwordConfirm) {
                errorEl.textContent = 'Passwords do not match';
                errorEl.classList.remove('hidden');
                return;
            }
            
            // Get existing users
            const users = JSON.parse(localStorage.getItem('focushub_users') || '[]');
            
            // Check if email already exists
            if (users.find(u => u.email === email)) {
                errorEl.textContent = 'An account with this email already exists';
                errorEl.classList.remove('hidden');
                return;
            }
            
            // Create new user
            const newUser = {
                id: 'user_' + Date.now(),
                email: email,
                password: btoa(password), // Base64 encoding (not secure, but works for localStorage)
                mode: mode,
                subMode: mode === 'student' ? 'highschool' : null,
                created: new Date().toISOString(),
                plan: 'free'
            };
            
            // Save user
            users.push(newUser);
            localStorage.setItem('focushub_users', JSON.stringify(users));
            
            // Set current user
            localStorage.setItem('focushub_current_user', JSON.stringify({
                id: newUser.id,
                email: newUser.email,
                mode: newUser.mode,
                created: newUser.created
            }));
            
            // Set mode for config system
            localStorage.setItem('focushub_mode', newUser.mode);
            if (newUser.mode === 'student') {
                localStorage.setItem('focushub_student_submode', 'highschool');
            }
            
            // Migrate any existing localStorage data to this user
            migrateExistingData(newUser.id);
            
            // Redirect to app
            window.location.href = 'app.html';
        }
        
        function migrateExistingData(userId) {
            // Migrate all existing localStorage data to user-namespaced keys
            const keysToMigrate = [
                'focushub_tasks',
                'focushub_daily_stats',
                'focushub_history',
                'focushub_distractions',
                'focushub_intentions',
                'focushub_tough_love',
                'focushub_timer',
                'focushub_session_state',
                'focushub_session_date'
            ];
            
            keysToMigrate.forEach(key => {
                const existingData = localStorage.getItem(key);
                if (existingData) {
                    localStorage.setItem(`${key}_${userId}`, existingData);
                    // Don't remove the original yet, in case multiple users want to claim it
                }
            });
        }
        
        // Theme detection
        function initTheme() {
            const theme = localStorage.getItem('focushub_theme') || 'light';
            const authLogo = document.querySelector('.auth-logo');
            
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                authLogo.src = 'FocusHub_vertinv.png';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                authLogo.src = 'FocusHub_vertnorm.png';
            }
        }
        
        initTheme();
    </script>
</body>
</html>
