<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusHub - Mission Control</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f9fafb;
            color: #111827;
            min-height: 100vh;
            padding: 2rem;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .logo {
            height: 32px;
        }

        .streak-badge {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid #e5e7eb;
            color: white;
        }

        h1 {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 2rem;
            font-size: 13px;
        }

        /* Bento Grid */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .card-large {
            grid-column: span 3;
            grid-row: span 2;
        }

        .card-medium {
            grid-column: span 2;
        }

        .card-small {
            grid-column: span 1;
        }

        .card-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 200px;
        }

        .line-chart {
            width: 100%;
            height: 100%;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 120px;
            gap: 0.5rem;
            padding-top: 1rem;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .bar {
            width: 100%;
            background: #d1d5db;
            border-radius: 4px 4px 0 0;
            min-height: 4px;
            transition: all 0.5s ease;
            position: relative;
            animation: growBar 0.8s ease-out;
        }

        @keyframes growBar {
            from { height: 0; }
            to { height: var(--bar-height); }
        }

        .bar.today {
            background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
        }

        .bar-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
        }

        .bar-value {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 700;
            color: #111827;
        }

        /* Donut Chart */
        .donut-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 180px;
        }

        .donut-chart {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .donut-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .donut-segment {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
            animation: fillDonut 1s ease-out;
        }

        @keyframes fillDonut {
            from { stroke-dashoffset: 283; }
        }

        .donut-bg {
            stroke: #e5e7eb;
        }

        .donut-fill {
            stroke: #2563EB;
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-value {
            font-size: 32px;
            font-weight: 800;
            color: #111827;
            line-height: 1;
        }

        .donut-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Stats */
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: #111827;
            line-height: 1;
        }

        .stat-label {
            font-size: 10px;
            color: #6b7280;
            margin-top: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Action Button */
        .action-bar {
            grid-column: 1 / -1;
        }

        .btn-start {
            width: 100%;
            background: linear-gradient(135deg, #e3302f 0%, #c72827 100%);
            color: white;
            border: none;
            padding: 1.25rem 2rem;
            font-size: 16px;
            font-weight: 800;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: block;
            text-align: center;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .bento-grid {
                grid-template-columns: 1fr;
            }

            .card-large,
            .card-medium,
            .card-small {
                grid-column: span 1;
                grid-row: span 1;
            }

            .chart-container {
                height: 150px;
            }

            .bar-chart {
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/FocusHub_horinorm.svg" alt="FocusHub" class="logo">
            <div class="streak-badge" id="streakBadge" style="display: none;">
                ðŸ”¥ <span id="streakCount">0</span>
            </div>
        </div>

        <h1>Mission Control</h1>
        <p class="subtitle">Your productivity dashboard</p>

        <div class="bento-grid">
            <!-- Activity Chart (Large) -->
            <div class="card card-large">
                <div class="card-title">Sprint Activity (Last 7 Days)</div>
                <div class="chart-container">
                    <svg class="line-chart" id="activityChart" viewBox="0 0 100 50">
                        <!-- Generated by JS -->
                    </svg>
                </div>
                <div class="stat-row">
                    <div class="stat-item">
                        <div class="stat-value" id="totalSprints">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgSprints">0</div>
                        <div class="stat-label">Daily Avg</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="peakDay">--</div>
                        <div class="stat-label">Peak Day</div>
                    </div>
                </div>
            </div>

            <!-- Focus Score (Small) -->
            <div class="card card-small">
                <div class="card-title">Yesterday</div>
                <div class="donut-container">
                    <div class="donut-chart">
                        <svg class="donut-ring" viewBox="0 0 100 100">
                            <circle class="donut-segment donut-bg" cx="50" cy="50" r="45"></circle>
                            <circle class="donut-segment donut-fill" cx="50" cy="50" r="45" id="donutFill"
                                stroke-dasharray="283" stroke-dashoffset="283"></circle>
                        </svg>
                        <div class="donut-center">
                            <div class="donut-value" id="gradeValue">--</div>
                            <div class="donut-label">Grade</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Streak Bar Chart (Medium) -->
            <div class="card card-medium">
                <div class="card-title">7-Day Streak</div>
                <div class="bar-chart" id="streakChart">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card card-medium">
                <div class="card-title">This Week</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div class="stat-item">
                        <div class="stat-value" id="weekSprints">0</div>
                        <div class="stat-label">Sprints</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="weekTasks">0</div>
                        <div class="stat-label">Tasks Done</div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <a href="/app.html" class="btn-start">â†’ Start Session</a>
            </div>
        </div>
    </div>

    <script>
        // Load data
        const gradeHistory = JSON.parse(localStorage.getItem('focushub_grade_history') || '[]');
        const streakData = JSON.parse(localStorage.getItem('focushub_streak') || '{"count": 0}');

        // Show streak
        if (streakData.count > 0) {
            document.getElementById('streakCount').textContent = streakData.count;
            document.getElementById('streakBadge').style.display = 'flex';
        }

        // Get last 7 days data
        const last7Days = [];
        const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        for (let i = 6; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            const dateStr = date.toDateString();
            const dayData = gradeHistory.find(entry => entry.date === dateStr);
            const sprints = dayData ? dayData.sprintCount || 0 : 0;
            const tasks = dayData ? dayData.tasksCompleted || 0 : 0;
            const dayName = days[date.getDay() === 0 ? 6 : date.getDay() - 1];
            last7Days.push({ sprints, tasks, day: i === 0 ? 'Today' : dayName, isToday: i === 0 });
        }

        // Calculate stats
        const totalSprints = last7Days.reduce((sum, d) => sum + d.sprints, 0);
        const avgSprints = (totalSprints / 7).toFixed(1);
        const maxSprints = Math.max(...last7Days.map(d => d.sprints));
        const peakDay = last7Days.find(d => d.sprints === maxSprints);
        const weekTasks = last7Days.reduce((sum, d) => sum + d.tasks, 0);

        document.getElementById('totalSprints').textContent = totalSprints;
        document.getElementById('avgSprints').textContent = avgSprints;
        document.getElementById('peakDay').textContent = maxSprints > 0 ? peakDay.day : '--';
        document.getElementById('weekSprints').textContent = totalSprints;
        document.getElementById('weekTasks').textContent = weekTasks;

        // Draw line chart
        const svg = document.getElementById('activityChart');
        const maxY = Math.max(...last7Days.map(d => d.sprints), 1);
        const points = last7Days.map((d, i) => {
            const x = (i / (last7Days.length - 1)) * 90 + 5;
            const y = 45 - (d.sprints / maxY * 35);
            return `${x},${y}`;
        }).join(' ');

        // Gradient fill
        const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
        gradient.innerHTML = `
            <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#2563EB;stop-opacity:0.3" />
                <stop offset="100%" style="stop-color:#2563EB;stop-opacity:0" />
            </linearGradient>
        `;
        svg.appendChild(gradient);

        // Fill area
        const fillPoints = `5,45 ${points} 95,45`;
        const fill = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        fill.setAttribute('points', fillPoints);
        fill.setAttribute('fill', 'url(#lineGradient)');
        svg.appendChild(fill);

        // Line
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
        line.setAttribute('points', points);
        line.setAttribute('fill', 'none');
        line.setAttribute('stroke', '#2563EB');
        line.setAttribute('stroke-width', '0.8');
        line.setAttribute('stroke-linecap', 'round');
        line.style.animation = 'drawLine 1s ease-out';
        svg.appendChild(line);

        // Draw bar chart
        const streakChart = document.getElementById('streakChart');
        last7Days.forEach(day => {
            const barItem = document.createElement('div');
            barItem.className = 'bar-item';
            
            const height = maxSprints > 0 ? (day.sprints / maxSprints) * 100 : 0;
            const bar = document.createElement('div');
            bar.className = day.isToday ? 'bar today' : 'bar';
            bar.style.setProperty('--bar-height', height + '%');
            bar.style.height = height + '%';
            
            if (day.sprints > 0) {
                const value = document.createElement('span');
                value.className = 'bar-value';
                value.textContent = day.sprints;
                bar.appendChild(value);
            }
            
            const label = document.createElement('div');
            label.className = 'bar-label';
            label.textContent = day.day;
            
            barItem.appendChild(bar);
            barItem.appendChild(label);
            streakChart.appendChild(barItem);
        });

        // Draw donut chart
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toDateString();
        const yesterdayData = gradeHistory.find(entry => entry.date === yesterdayStr);

        if (yesterdayData && yesterdayData.grade) {
            const gradeMap = { 'A': 95, 'B': 85, 'C': 75, 'D': 65, 'F': 50 };
            const score = gradeMap[yesterdayData.grade] || 0;
            document.getElementById('gradeValue').textContent = yesterdayData.grade;
            
            const donutFill = document.getElementById('donutFill');
            const circumference = 283;
            const offset = circumference - (score / 100) * circumference;
            setTimeout(() => {
                donutFill.style.strokeDashoffset = offset;
            }, 100);
        }
    </script>
</body>
</html>
