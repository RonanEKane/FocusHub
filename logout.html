<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Terminated - FocusHub</title>
    <link rel="stylesheet" href="style.css?v=20.4">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <style>
        /* Additional logout-specific styles */
        .logout-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: var(--bg-primary);
        }

        .logout-content {
            max-width: 600px;
            width: 100%;
        }

        .logout-logo {
            text-align: center;
            margin-bottom: 3rem;
        }

        .logout-logo img {
            height: 80px;
            width: auto;
        }

        /* Main card with strong contrast */
        .logout-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-medium);
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .status-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--industrial-orange);
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: var(--bg-tertiary);
        }

        .logout-title {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .logout-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            line-height: 1.6;
        }

        .stats-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-medium);
            padding: 2rem 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stats-label {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--industrial-orange);
            font-family: 'JetBrains Mono', 'Courier New', monospace;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            letter-spacing: 0.5px;
        }

        .schedule-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-medium);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .schedule-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-medium);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .schedule-btn:hover {
            background: var(--bg-elevated);
            border-color: var(--industrial-orange);
            transform: translateY(-2px);
        }

        .schedule-btn.selected {
            background: var(--industrial-orange);
            border-color: var(--industrial-orange);
            color: white;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn-primary-logout {
            display: block;
            background: var(--industrial-orange);
            color: white;
            padding: 1rem;
            text-decoration: none;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: 2px solid var(--industrial-orange);
            transition: all 0.2s;
        }

        .btn-primary-logout:hover {
            background: var(--bg-secondary);
            color: var(--industrial-orange);
        }

        .btn-secondary-logout {
            display: block;
            border: 2px solid var(--border-medium);
            color: var(--text-primary);
            padding: 1rem;
            text-decoration: none;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            background: transparent;
            transition: all 0.2s;
        }

        .btn-secondary-logout:hover {
            border-color: var(--industrial-orange);
            color: var(--industrial-orange);
        }

        .footer-tip {
            text-align: center;
            margin-top: 2rem;
            font-size: 13px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', 'Courier New', monospace;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    
    <div class="logout-container">
        <div class="logout-content">
            <!-- Logo -->
            <div class="logout-logo">
                <img src="FocusHub_vertnorm.svg" alt="FocusHub" id="logoImg">
            </div>
            
            <!-- Main Card -->
            <div class="logout-card">
                <!-- Status Icon -->
                <div class="status-icon">‚è∏</div>
                
                <!-- Header -->
                <h1 class="logout-title">SESSION TERMINATED</h1>
                
                <p class="logout-subtitle">
                    Your progress is saved in the cloud.<br>
                    Return anytime to continue your mission.
                </p>
                
                <!-- Session Stats (if available) -->
                <div id="sessionStats" class="stats-card hidden">
                    <div class="stats-label">FINAL STATS</div>
                    <div class="stats-grid">
                        <div>
                            <div class="stat-value" id="statSprints">0</div>
                            <div class="stat-label">SPRINTS</div>
                        </div>
                        <div>
                            <div class="stat-value" id="statTasks">0</div>
                            <div class="stat-label">TASKS</div>
                        </div>
                        <div>
                            <div class="stat-value" id="statGrade">‚Äî</div>
                            <div class="stat-label">GRADE</div>
                        </div>
                    </div>
                </div>
                
                <!-- Next Session Scheduler -->
                <div class="schedule-card">
                    <div class="stats-label">SCHEDULE NEXT SESSION</div>
                    
                    <p class="logout-subtitle">When will you return?</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <button onclick="scheduleSession('tomorrow_08')" class="schedule-btn">
                            <div class="stat-label">TOMORROW</div>
                            <div style="font-size: 18px; font-weight: 700; margin-top: 0.25rem;">08:00</div>
                        </button>
                        
                        <button onclick="scheduleSession('tomorrow_12')" class="schedule-btn">
                            <div class="stat-label">TOMORROW</div>
                            <div style="font-size: 18px; font-weight: 700; margin-top: 0.25rem;">12:00</div>
                        </button>
                        
                        <button onclick="scheduleSession('monday_09')" class="schedule-btn">
                            <div class="stat-label">MONDAY</div>
                            <div style="font-size: 18px; font-weight: 700; margin-top: 0.25rem;">09:00</div>
                        </button>
                    </div>
                    
                    <div id="commitmentMsg" class="hidden" style="margin-top: 1rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-left: 3px solid var(--success); color: var(--success); font-family: 'JetBrains Mono', monospace; font-size: 12px; letter-spacing: 0.5px;">
                        ‚úì COMMITMENT LOGGED
                    </div>
                </div>
                
                <!-- Beta Feedback Prompt -->
                <div id="betaFeedbackPrompt" style="background: rgba(245, 91, 7, 0.1); border: 2px solid var(--industrial-orange); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; display: none;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <span style="font-size: 2rem;">üß™</span>
                        <div style="flex: 1; text-align: left;">
                            <h3 style="color: var(--industrial-orange); font-size: 1.125rem; margin-bottom: 0.25rem;">Help Us Improve</h3>
                            <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0;">Quick 5-question survey (2 minutes)</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <a href="beta-feedback.html" class="btn btn-primary" style="flex: 1; text-decoration: none; display: inline-block; padding: 0.75rem;">
                            Share Feedback
                        </a>
                        <button onclick="dismissFeedbackPrompt()" class="btn btn-secondary" style="flex: 1;">
                            Maybe Later
                        </button>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="action-buttons">
                    <a href="app.html" class="btn-primary-logout">
                        ‚Üí SIGN BACK IN
                    </a>
                    <a href="index.html" class="btn-secondary-logout">
                        RETURN TO HOME
                    </a>
                </div>
            </div>
            
            <!-- Footer Tip -->
            <p class="footer-tip">
                üí° TIP: Install FocusHub as an app for faster access
            </p>
        </div>
    </div>
        <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-medium);">
            <p style="font-size: 12px; color: var(--text-secondary); line-height: 1.6; font-family: 'Courier New', monospace; letter-spacing: 0.5px;">
                PRO TIP: INSTALL AS PWA FOR INSTANT ACCESS
            </p>
        </div>
    </div>

<style>
.schedule-btn {
    border: 1px solid var(--border-medium);
    background: var(--bg-secondary);
    color: var(--text-primary);
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Inter', sans-serif;
}

.schedule-btn:hover {
    border-color: var(--accent-blue);
    background: var(--bg-primary);
}

.schedule-btn.selected {
    border-color: var(--success);
    background: rgba(34, 197, 94, 0.1);
}

.hidden {
    display: none;
}

@media (max-width: 768px) {
    [style*="grid-template-columns: repeat(3, 1fr)"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
// Load and display session stats
const logoutStats = sessionStorage.getItem('focushub_logout_stats');
if (logoutStats) {
    try {
        const stats = JSON.parse(logoutStats);
        document.getElementById('statSprints').textContent = stats.sprints || 0;
        document.getElementById('statTasks').textContent = stats.tasks || 0;
        document.getElementById('statGrade').textContent = stats.grade || '‚Äî';
        document.getElementById('sessionStats').classList.remove('hidden');
        
        sessionStorage.removeItem('focushub_logout_stats');
    } catch (e) {
        console.error('Error parsing logout stats:', e);
    }
}

// Schedule next session (strictly local, no DB queries)
function scheduleSession(timeSlot) {
    // Parse time slot
    const now = new Date();
    let scheduleDate = new Date();
    
    if (timeSlot === 'tomorrow_08') {
        scheduleDate.setDate(now.getDate() + 1);
        scheduleDate.setHours(8, 0, 0, 0);
    } else if (timeSlot === 'tomorrow_12') {
        scheduleDate.setDate(now.getDate() + 1);
        scheduleDate.setHours(12, 0, 0, 0);
    } else if (timeSlot === 'monday_09') {
        // Find next Monday
        const daysUntilMonday = (8 - now.getDay()) % 7 || 7;
        scheduleDate.setDate(now.getDate() + daysUntilMonday);
        scheduleDate.setHours(9, 0, 0, 0);
    }
    
    // Generate .ics file content
    const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//FocusHub//Next Session//EN
BEGIN:VEVENT
UID:focushub-${Date.now()}@focushub.app
DTSTAMP:${formatICSDate(now)}
DTSTART:${formatICSDate(scheduleDate)}
DTEND:${formatICSDate(new Date(scheduleDate.getTime() + 60*60*1000))}
SUMMARY:FocusHub Session
DESCRIPTION:Return to FocusHub and start your next productive session.
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`;
    
    // Create download link
    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'focushub-next-session.ics';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Visual feedback
    document.querySelectorAll('.schedule-btn').forEach(btn => btn.classList.remove('selected'));
    event.target.closest('.schedule-btn').classList.add('selected');
    
    const msg = document.getElementById('commitmentMsg');
    msg.classList.remove('hidden');
    setTimeout(() => {
        msg.classList.add('hidden');
    }, 3000);
}

// Helper to format date for .ics
function formatICSDate(date) {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
}

// supabaseClient is already created in supabase-config.js

async function performLogout() {
    try {
        const { error } = await supabaseClient.auth.signOut();
        if (error) {
            console.error('Error signing out:', error);
        } else {
            console.log('‚úÖ Logged out successfully');
        }
    } catch (err) {
        console.error('Logout error:', err);
    }
    
    // Clear local data
    localStorage.removeItem('focushub_session_state');
    localStorage.removeItem('focushub_membership');
    sessionStorage.clear();
}

// Perform logout on page load
performLogout();

// Show beta feedback prompt if haven't submitted yet
function showBetaFeedbackPrompt() {
    const hasSubmitted = localStorage.getItem('focushub_beta_feedback_submitted');
    const lastDismissed = localStorage.getItem('focushub_beta_feedback_dismissed');
    const now = Date.now();
    
    // Show if:
    // 1. Haven't submitted feedback yet
    // 2. AND (never dismissed OR dismissed more than 3 days ago)
    if (!hasSubmitted) {
        if (!lastDismissed || (now - parseInt(lastDismissed)) > (3 * 24 * 60 * 60 * 1000)) {
            document.getElementById('betaFeedbackPrompt').style.display = 'block';
        }
    }
}

function dismissFeedbackPrompt() {
    document.getElementById('betaFeedbackPrompt').style.display = 'none';
    localStorage.setItem('focushub_beta_feedback_dismissed', Date.now().toString());
}

// Check if user is beta tester and show prompt
setTimeout(showBetaFeedbackPrompt, 1000);
</script>

    <script>
        // Theme restoration - MUST RUN FIRST
        (function() {
            const theme = localStorage.getItem("focushub_theme") || "dark";
            document.documentElement.className = `theme-${theme}`;
            
            // Update logo for theme
            const logo = document.getElementById("logoImg");
            if (logo) {
                logo.src = theme === "dark" ? "FocusHub_vertinv.svg" : "FocusHub_vertnorm.svg";
            }
        })();
    </script>
</body>
</html>
