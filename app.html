<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusHub - Built for Brains That Wander, but Still Want to Win</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="logo-section">
            <div style="position: relative; display: inline-block;">
                <img id="appLogo" src="FocusHub_horiinv.svg" alt="FocusHub" style="height: 32px; width: auto;">
                <span style="position: absolute; top: -6px; right: -38px; background: #f45b07; color: white; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 3px; letter-spacing: 0.5px;">BETA</span>
            </div>
            <p class="tagline">Built for Brains That Wander, but Still Want to Win</p>
        </div>
        <div class="header-actions">
            <button class="btn" id="dashboardBtn">üìä Dashboard</button>
            <button class="btn" id="themeToggle">üåô Dark</button>
            <button class="btn" id="logoutBtn">Logout</button>
            <button class="btn btn-danger" id="endDayBtn">END DAY</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="app-container">
        <!-- Left Column: Main Content -->
        <main class="main-content">
            <!-- Sprint Timer Section -->
            <section class="sprint-timer-section">
                <div class="section-header">
                    <h2>‚è±Ô∏è SPRINT TIMER</h2>
                </div>
                
                <div class="energy-row">
                    <div class="energy-select">
                        <label>Energy:</label>
                        <select id="energyLevel">
                            <option value="low">‚ö° Kinda "Meh"</option>
                            <option value="medium">‚ö°‚ö° Solid</option>
                            <option value="high">‚ö°‚ö°‚ö° Locked In</option>
                        </select>
                    </div>
                    <label class="meeting-toggle">
                        <input type="checkbox" id="meetingToggle"> Meeting
                    </label>
                </div>

                <div class="timer-buttons">
                    <button class="timer-btn" data-duration="15">15 min</button>
                    <button class="timer-btn active" data-duration="20">20 min</button>
                    <button class="timer-btn" data-duration="30">30 min</button>
                    <button class="timer-btn timer-btn-break" data-duration="5">Break</button>
                </div>

                <div class="timer-display" id="timerDisplay">
                    Start a session to begin working.
                </div>
            </section>

            <!-- Task Command Center -->
            <section class="task-section">
                <div class="section-header">
                    <h2>‚ö° TASK COMMAND CENTER</h2>
                    <span class="sprint-target">Target: <span id="sprintTarget">5</span> sprints</span>
                </div>

                <div class="task-input-wrapper">
                    <label class="input-label">WHAT NEEDS DOING?</label>
                    <p class="input-hint">Paste your task list below (one task per line)</p>
                    <textarea id="taskInput" class="task-textarea" placeholder="Add Task"></textarea>
                </div>

                <button class="parse-btn" id="parseBtn">PARSE & ADD TO HOLDING AREA</button>

                <div class="holding-area">
                    <div class="holding-header">
                        <h3>üì¶ Holding Area</h3>
                        <span class="task-count" id="holdingCount">0</span>
                    </div>
                    <div id="holdingTasks" class="task-list">
                        <!-- Tasks will appear here -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Right Column: Sidebar -->
        <aside class="sidebar">
            <!-- Tough Love Mode -->
            <div class="sidebar-card">
                <h3>‚ö° TOUGH LOVE MODE</h3>
                <div class="mode-selector">
                    <button class="mode-btn" data-mode="supportive">Supportive</button>
                    <button class="mode-btn active" data-mode="balanced">Balanced</button>
                    <button class="mode-btn" data-mode="tough">Tough</button>
                </div>
                <p class="mode-description">Changes how the AI Agent talks to you</p>
            </div>

            <!-- AI Agent -->
            <div class="sidebar-card">
                <h3>ü§ñ AI AGENT</h3>
                <div class="ai-message" id="aiMessage">
                    Ready to execute. Let's go.
                </div>
            </div>

            <!-- Stats -->
            <div class="sidebar-card">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">SPRINTS</div>
                        <div class="stat-value"><span id="sprintsDone">0</span> / <span id="sprintsTotal">5</span></div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">WINS</div>
                        <div class="stat-value" id="winsCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">BREAKS</div>
                        <div class="stat-value" id="breaksCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">DISTRACTIONS</div>
                        <div class="stat-value" id="distractionsCount">0</div>
                    </div>
                </div>
            </div>

            <!-- Distraction Parking -->
            <div class="sidebar-card">
                <h3>üö´ DISTRACTION PARKING</h3>
                <div class="distraction-count-display" id="distractionCountDisplay">0</div>
                <div class="distraction-input-row">
                    <input type="text" id="distractionInput" class="distraction-input" placeholder="Park that distraction here...">
                    <label class="checkbox-label">
                        <input type="checkbox" id="handleLaterCheck"> I'll handle this
                    </label>
                    <button class="park-btn" id="parkBtn">PARK IT</button>
                </div>
            </div>

            <!-- Current Grade -->
            <div class="sidebar-card">
                <h3>üìä CURRENT GRADE</h3>
                <div class="grade-display" id="gradeDisplay">
                    <div class="grade-letter">-</div>
                    <div class="grade-message">Start working to get graded</div>
                </div>
            </div>
        </aside>
    </div>

    <script src="supabase-config.js"></script>
    <script>
        // Initialize app state
        const state = {
            sprintCount: 0,
            breaksCount: 0,
            distractionCount: 0,
            tasks: {
                holding: [],
                wins: []
            },
            currentMode: 'balanced',
            timer: {
                active: false,
                duration: 20,
                remaining: 0,
                interval: null
            }
        };

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('focushub_state');
            if (saved) {
                Object.assign(state, JSON.parse(saved));
                renderAll();
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('focushub_state', JSON.stringify(state));
        }

        // Render all UI elements
        function renderAll() {
            document.getElementById('sprintsDone').textContent = state.sprintCount;
            document.getElementById('winsCount').textContent = state.tasks.wins.length;
            document.getElementById('breaksCount').textContent = state.breaksCount;
            document.getElementById('distractionsCount').textContent = state.distractionCount;
            document.getElementById('distractionCountDisplay').textContent = state.distractionCount;
            document.getElementById('holdingCount').textContent = state.tasks.holding.length;
        }

        // Timer button handlers
        document.querySelectorAll('.timer-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.timer-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.timer.duration = parseInt(this.dataset.duration);
                saveState();
            });
        });

        // Mode selector
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.currentMode = this.dataset.mode;
                saveState();
            });
        });

        // Parse button
        document.getElementById('parseBtn').addEventListener('click', function() {
            const input = document.getElementById('taskInput').value.trim();
            if (!input) return;
            
            const tasks = input.split('\n').filter(t => t.trim());
            tasks.forEach(task => {
                state.tasks.holding.push({
                    id: Date.now() + Math.random(),
                    text: task.trim(),
                    completed: false
                });
            });
            
            document.getElementById('taskInput').value = '';
            saveState();
            renderAll();
        });

        // Park distraction
        document.getElementById('parkBtn').addEventListener('click', function() {
            const input = document.getElementById('distractionInput');
            if (!input.value.trim()) return;
            
            state.distractionCount++;
            input.value = '';
            document.getElementById('handleLaterCheck').checked = false;
            saveState();
            renderAll();
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (confirm('Are you sure you want to logout?')) {
                const result = await handleSignout();
                if (result.success) {
                    localStorage.clear();
                    window.location.href = '/';
                }
            }
        });

        // Initialize
        loadState();
    </script>
</body>
</html>
