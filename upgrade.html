<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade - FocusHub</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .upgrade-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }
        
        .upgrade-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .upgrade-header h1 {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .upgrade-header p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .pricing-toggle {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 3rem;
        }
        
        .pricing-toggle button {
            padding: 0.75rem 2rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pricing-toggle button.active {
            background: var(--industrial-orange);
            border-color: var(--industrial-orange);
            color: white;
        }
        
        .pricing-toggle .save-badge {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .pricing-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 2rem;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .pricing-card:hover {
            transform: translateY(-4px);
            border-color: var(--industrial-orange);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }
        
        .pricing-card.popular {
            border-color: var(--industrial-orange);
            border-width: 3px;
        }
        
        .popular-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: var(--industrial-orange);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .tier-emoji {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .tier-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .tier-tagline {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .tier-price {
            margin-bottom: 1.5rem;
        }
        
        .price-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--industrial-orange);
        }
        
        .price-period {
            font-size: 1rem;
            color: var(--text-secondary);
        }
        
        .price-trial {
            font-size: 0.875rem;
            color: var(--industrial-orange);
            font-weight: 600;
            margin-top: 0.5rem;
        }
        
        .tier-cta {
            width: 100%;
            padding: 1rem;
            background: var(--industrial-orange);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1.5rem;
        }
        
        .tier-cta:hover {
            background: #d94f06;
            transform: translateY(-2px);
        }
        
        .tier-cta.secondary {
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            color: var(--text-primary);
        }
        
        .tier-cta.secondary:hover {
            border-color: var(--industrial-orange);
            background: var(--bg-secondary);
        }
        
        .features-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .features-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .features-list li:last-child {
            border-bottom: none;
        }
        
        .feature-check {
            color: #22c55e;
            font-weight: 700;
        }
        
        .feature-x {
            color: #ef4444;
            font-weight: 700;
        }
        
        .comparison-section {
            margin-top: 4rem;
        }
        
        .comparison-table {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .comparison-table th {
            background: var(--bg-primary);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border-light);
        }
        
        .comparison-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .faq-section {
            max-width: 800px;
            margin: 4rem auto;
        }
        
        .faq-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .faq-question {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .faq-answer {
            color: var(--text-secondary);
            line-height: 1.6;
        }
    </style>
    
    <!-- Lemon Squeezy SDK -->
    <script src="https://app.lemonsqueezy.com/js/lemon.js" defer></script>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <div class="upgrade-container">
        <!-- Header -->
        <div class="upgrade-header">
            <h1>Choose Your Plan</h1>
            <p>Built for brains that wander, but still want to win. No games, no fluff‚Äîjust structure that works.</p>
        </div>
        
        <!-- Monthly/Annual Toggle -->
        <div class="pricing-toggle">
            <button id="monthlyBtn" class="active" onclick="showMonthly()">Monthly</button>
            <button id="annualBtn" onclick="showAnnual()">Annual</button>
            <span class="save-badge">Save 17%</span>
        </div>
        
        <!-- Pricing Cards -->
        <div class="pricing-grid">
            <!-- Lite -->
            <div class="pricing-card">
                <div class="tier-emoji">üí°</div>
                <div class="tier-name">Lite</div>
                <div class="tier-tagline">Core productivity, no frills</div>
                
                <div class="tier-price">
                    <div class="price-amount" id="litePrice">$3.99</div>
                    <div class="price-period">/month</div>
                    <div class="price-trial">7 days free, no card required</div>
                </div>
                
                <button class="tier-cta secondary" onclick="selectPlan('lite', 'monthly')" id="liteCTA">
                    Start Free Trial
                </button>
                
                <ul class="features-list">
                    <li><span class="feature-check">‚úì</span> Sprint timer (energy-based)</li>
                    <li><span class="feature-check">‚úì</span> Task management (3 buckets)</li>
                    <li><span class="feature-check">‚úì</span> Distraction parking</li>
                    <li><span class="feature-check">‚úì</span> AI tough-love coaching</li>
                    <li><span class="feature-check">‚úì</span> Daily grading</li>
                    <li><span class="feature-check">‚úì</span> Daily Wisdom Foundation (7 Traditions)</li>
                    <li><span class="feature-check">‚úì</span> Basic analytics (30 days)</li>
                    <li><span class="feature-x">‚úó</span> Multi-device sync</li>
                    <li><span class="feature-x">‚úó</span> Keyboard shortcuts</li>
                    <li><span class="feature-x">‚úó</span> Data export</li>
                </ul>
            </div>
            
            <!-- Pro -->
            <div class="pricing-card popular">
                <div class="popular-badge">MOST POPULAR</div>
                <div class="tier-emoji">‚ö°</div>
                <div class="tier-name">Pro</div>
                <div class="tier-tagline">Sync everywhere, work anywhere</div>
                
                <div class="tier-price">
                    <div class="price-amount" id="proPrice">$9.99</div>
                    <div class="price-period">/month</div>
                    <div class="price-trial">First 14 days: $4.99</div>
                </div>
                
                <button class="tier-cta" onclick="selectPlan('pro', 'monthly')" id="proCTA">
                    Start Trial at $4.99
                </button>
                
                <ul class="features-list">
                    <li><span class="feature-check">‚úì</span> <strong>Everything in Lite</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>Multi-device sync</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>Premium keyboard shortcuts</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>Data export (CSV/JSON)</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>Pomodoro variations</strong></li>
                    <li><span class="feature-check">‚úì</span> Unlimited analytics</li>
                    <li><span class="feature-check">‚úì</span> Weekly summary emails</li>
                    <li><span class="feature-x">‚úó</span> Reflection tradition choice</li>
                    <li><span class="feature-x">‚úó</span> Advanced analytics</li>
                </ul>
            </div>
            
            <!-- Premium -->
            <div class="pricing-card">
                <div class="tier-emoji">‚≠ê</div>
                <div class="tier-name">Premium</div>
                <div class="tier-tagline">Maximum focus, minimum distraction</div>
                
                <div class="tier-price">
                    <div class="price-amount" id="premiumPrice">$19.99</div>
                    <div class="price-period">/month</div>
                    <div class="price-trial">First 14 days: $9.99</div>
                </div>
                
                <button class="tier-cta" onclick="selectPlan('premium', 'monthly')" id="premiumCTA">
                    Start Trial at $9.99
                </button>
                
                <ul class="features-list">
                    <li><span class="feature-check">‚úì</span> <strong>Everything in Pro</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>Choose reflection tradition</strong> (7 options)</li>
                    <li><span class="feature-check">‚úì</span> <strong>Advanced analytics dashboard</strong></li>
                    <li><span class="feature-check">‚úì</span> <strong>AI coaching intensity control</strong></li>
                    <li><span class="feature-check">‚úì</span> Custom sprint durations</li>
                    <li><span class="feature-check">‚úì</span> Focus Mode (distraction-free)</li>
                    <li><span class="feature-check">‚úì</span> Beta features early access</li>
                    <li><span class="feature-check">‚úì</span> API access</li>
                </ul>
            </div>
        </div>
        
        <!-- FAQ -->
        <div class="faq-section">
            <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">Frequently Asked Questions</h2>
            
            <div class="faq-item">
                <div class="faq-question">How do trials work?</div>
                <div class="faq-answer">
                    <strong>Lite:</strong> 7 days completely free, no card required. After trial, enter card to continue at $3.99/mo.<br><br>
                    <strong>Pro:</strong> Enter card, charged $4.99 immediately for 14 days. On day 15, you must actively choose to continue at $9.99/mo (no auto-charge).<br><br>
                    <strong>Premium:</strong> Enter card, charged $9.99 immediately for 14 days. On day 15, you must actively choose to continue at $19.99/mo (no auto-charge).
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Are charges automatic?</div>
                <div class="faq-answer">
                    <strong>No.</strong> We hate surprise charges. After your trial ends, you must actively click "Continue" to subscribe at the full price. If you do nothing, your access simply locks‚Äîno sneaky charges.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Can I cancel anytime?</div>
                <div class="faq-answer">
                    Yes. Cancel from your account settings anytime. Refunds are only available within 5 days of billing. After that, your access continues until the end of your current billing period, then stops automatically.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Can I downgrade?</div>
                <div class="faq-answer">
                    Yes. Downgrade from Premium ‚Üí Pro or Pro ‚Üí Lite anytime. Changes take effect at your next billing cycle, and you'll get the trial rate for the lower tier.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">What about refunds?</div>
                <div class="faq-answer">
                    Refunds are available within 5 days of your billing date. Contact <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d3a0a6a3a3bca1a793b5bcb0a6a0bba6b1fdb2a3a3">[email&#160;protected]</a> with your account details to request a refund within this window.
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">I'm a Beta user‚Äîwhat happens after Beta?</div>
                <div class="faq-answer">
                    Beta users currently have free access to all features during the beta period. When we launch publicly, beta users will receive a special discount code for 50% off the first year of Premium. We'll notify you via email before billing begins.
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <div style="text-align: center; margin-top: 3rem;">
            <a href="overview.html" style="color: var(--industrial-orange); font-size: 0.875rem; text-decoration: none;">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        let currentBillingCycle = 'monthly';
        
        // Check if user is already subscribed
        async function checkCurrentTier() {
            try {
                const tier = await getUserTier();
                const membership = await getUserMembership();
                
                // If user is already Premium or Beta, show message
                if (tier === 'beta') {
                    document.querySelector('.upgrade-header p').innerHTML = 
                        '<strong style="color: var(--success);">üéñÔ∏è You\'re a Beta user ‚Äî you have Premium forever!</strong>';
                    // Disable all CTAs
                    document.querySelectorAll('.tier-cta').forEach(btn => {
                        btn.disabled = true;
                        btn.textContent = 'You Have Access';
                        btn.style.opacity = '0.5';
                    });
                } else if (tier === 'premium') {
                    document.querySelector('.upgrade-header p').innerHTML = 
                        '<strong style="color: var(--success);">‚≠ê You\'re already on Premium!</strong>';
                } else if (tier === 'pro') {
                    // Highlight only Premium upgrade
                    document.getElementById('liteCTA').disabled = true;
                    document.getElementById('liteCTA').textContent = 'Current Tier or Lower';
                    document.getElementById('liteCTA').style.opacity = '0.5';
                    
                    document.getElementById('proCTA').disabled = true;
                    document.getElementById('proCTA').textContent = 'Current Tier';
                    document.getElementById('proCTA').style.opacity = '0.5';
                }
            } catch (error) {
                console.error('Error checking tier:', error);
            }
        }
        
        function showMonthly() {
            currentBillingCycle = 'monthly';
            document.getElementById('monthlyBtn').classList.add('active');
            document.getElementById('annualBtn').classList.remove('active');
            
            document.getElementById('litePrice').textContent = '$3.99';
            document.getElementById('proPrice').textContent = '$9.99';
            document.getElementById('premiumPrice').textContent = '$19.99';
            
            document.querySelectorAll('.price-period').forEach(el => el.textContent = '/month');
        }
        
        function showAnnual() {
            currentBillingCycle = 'annual';
            document.getElementById('annualBtn').classList.add('active');
            document.getElementById('monthlyBtn').classList.remove('active');
            
            document.getElementById('litePrice').textContent = '$39';
            document.getElementById('proPrice').textContent = '$99';
            document.getElementById('premiumPrice').textContent = '$199';
            
            document.querySelectorAll('.price-period').forEach(el => el.textContent = '/year');
        }
        
        function selectPlan(tier, cycle) {
            // Store selection
            sessionStorage.setItem('selected_tier', tier);
            sessionStorage.setItem('selected_cycle', cycle);
            
            // Redirect to Lemon Squeezy checkout
            // TODO: Replace with actual Lemon Squeezy checkout URLs
            const checkoutUrls = {
                'lite-monthly': 'https://focushub.lemonsqueezy.com/checkout/buy/LITE-MONTHLY-ID',
                'lite-annual': 'https://focushub.lemonsqueezy.com/checkout/buy/LITE-ANNUAL-ID',
                'pro-monthly': 'https://focushub.lemonsqueezy.com/checkout/buy/PRO-MONTHLY-ID',
                'pro-annual': 'https://focushub.lemonsqueezy.com/checkout/buy/PRO-ANNUAL-ID',
                'premium-monthly': 'https://focushub.lemonsqueezy.com/checkout/buy/PREMIUM-MONTHLY-ID',
                'premium-annual': 'https://focushub.lemonsqueezy.com/checkout/buy/PREMIUM-ANNUAL-ID'
            };
            
            const checkoutKey = `${tier}-${cycle}`;
            const checkoutUrl = checkoutUrls[checkoutKey];
            
            if (checkoutUrl) {
                // Open Lemon Squeezy checkout
                window.location.href = checkoutUrl;
      